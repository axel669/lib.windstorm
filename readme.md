# Windstorm
Windstorm is a library that allows element customization without needing to
use css directly and without predefining hundreds or thousands of css classes
with minor differences between a set of 20.

[Documentation Site](https://windstorm.axel669.net)

## Installation

> Note: the version number is not necessary in the url, but is recommended.
> Including the version ensures that if updates are made to the library, any
> compatibility issues or bugs that get introduced won't affect existing
> pages, and also allows updates to be done when intended.

### CDN Link (global variable)
```html
<script src="https://cdn.jsdelivr.net/npm/@axel669/windstorm@0.2.2/dist/browser.js"></script>
```

### CDN Link (module)
```js
// Only scanning, no functions
import "https://cdn.jsdelivr.net/npm/@axel669/windstorm@0.2.2/dist/module.mjs"
// Import functions + scanning
import ws from "https://cdn.jsdelivr.net/npm/@axel669/windstorm@0.2.2/dist/module.mjs"

ws.x({...stuff})
```

### Node Modules
```bash
npm add @axel669/windstorm
```

## Usage
Windstorm can be used as a standalone script added to the page, or included in
a bundle with other scripts/frameworks. Regardless of which form it's used in,
windstorm should be included in the body of the page before the content that it
will style in order to prevent FOUC. For static content, this means trhe script
tag that uses it should not be async or defered. For content generated by a
framework like React or Svelte, this should not be an issue as including
windstorm in the build bundle will allow it to run before the framework adds
DOM elements to the page.

Once added to the page, windstorm will scan all current elements, and any
elements added later for the `ws-x` attribute, and generate the necessary css
immediately. Component css is automatically added to the head as well, so no
extra work is needed to use any of the components. Components that transform
standard tags will only work if the tag has the `ws-x` on it (although the value
can be empty).

> Many of the windstorm components expect some css variables defined by the
> theme to be present, so a theme should always be applied to the body.

```html
<body ws-x="$theme[tron]">
    <script src="<windstorm>"></script>
    Static content here
</body>
```

> Any html elements that do not have the `ws-x` attribute are left alone,
> allowing windstorm to play nice with any other css lib (that I tried).

### ws-x Attribute
The `ws-x` attribute is what windstorm will scan to apply styles to elements.
The attribute can have any number of rules defined, using the format
`<name>(:<mods>)?([arg string])?`.

The name is the name of a windstorm function, a list of provided functions and
what they generate is in the [Built-in Functions](./lib/wind-funcs.md). The mods
refers to css pseudo classes and pseudo elements. Any of the pseudo selectors
can be used, and any number of them can be used in a single declaration. The use
of the pseudo selctors is optional, and any declarations without will apply to
elements as normal. The arg string is a string that is within `[]` and is passed
to the function with some preprocessing handled: any `&<name>` will be converted
to `var(--<name>)` before being passed to the function. The arg string can use
any characters except `[]` (spaces don't need to be converted or anything
funny).

```html
<div ws-x="&color[teal] w[100px]">
    content
    <!-- Regular border will use the --primary variable for color -->
    <!-- border-color is changed on hover only to use the --color variable -->
    <div ws-x="b[1px solid &primary] b-c:hover[&color]">
        other content
    </div>
</div>
```

### $app and ws-screen
The ws-screen component is designed to be a top level container for content that
has consistent scrolling behavior for child elements across browsers and
devices without the page resizing in weird ways from the various browser bars
hiding and unhiding themselves from scrolling on mobile.

As such, the use of ws-screen is entirely optional as all components will work
without it being used, and if the regular browser scrolling behavior is not an
issue, then ws-screen can be skipped entirely.

If ws-screen is used, the body tag must have the `$app` wind function added to
the `ws-x` attribute. This will setup the css properties needed for ws-screen
to control the scrolling behavior more effectively.

```html
<!-- Using ws-screen -->
<body ws-x="theme[tron] $app">
    <script src="<windstorm>"></script>
    <ws-screen>
        <ws-paper ws-x="$outline">
            <ws-flex>
                <button ws-x="$fill $color[primary] r[8px]">
                    Click Me!
                </button>
                <div ws-x="w[100px] h[200px] bg-c[teal]"></div>
            </ws-flex>
        </ws-paper>
    </ws-screen>
</body>
```
```html
<!-- Normal pages work fine -->
<body ws-x="theme[tron] $app">
    <script src="<windstorm>"></script>
    <ws-paper ws-x="$outline">
        <ws-flex>
            <button ws-x="$fill $color[primary] r[8px]">
                Click Me!
            </button>
            <div ws-x="w[100px] h[200px] bg-c[teal]"></div>
        </ws-flex>
    </ws-paper>
</body>
```

### Custom Functions
Windstorm has different kinds of custom function:
- normal functions that are just text, hypens, and dots (`[\w\-\.]+`)
- component customization functions are prefixed with `$`
- css custom properties (varaibles) that are prefixed with `&`

Internally there are slight differences in how each of these are processed.
- If no definition is found for a normal function, windstorm will log an error
    into the console.
- If no definition is found for component functions, no error is logged. Many
    of the component customizations are toggles or state so no code is required
    to process them; They exist only in css rules.
- CSS variables do not attempt to find a wind function.

#### Adding Custom Functions
Windstorm supports adding custom functions with the `custom` function documented
further down.

```html
<script src="https://cdn.jsdelivr.net/npm/@axel669/windstorm@0.2.0/dist/browser.js"></script>

<script>
ws.custom(
    "cust",
    (color) => ws.rules(
        ws.prop("border", `1px solid ${color}`),
        ws.prop("color", "&primary")
    )
)
</script>

<div ws-x="cust[teal]">Teal border, blue text</div>
<div ws-x="cust[&secondary]">Green border, blue text</div>
```

### API

Windstorm has a few utility functions for making dynamic ws-x declarations
easier, and making custom functions simpler.

#### x(object)
The `x` function takes in an object where each `[key, value]` pair will be
convertedm into a valid string for the `ws-x` attribute. The value can take one
of a few forms, and which form it takes will affect the output:
- A string that will be used as the arg string<br />
    `[key, value] -> "key[value]"`
- `true` (boolean) will output the function without an arg string<br />
    `[key, value] -> "key"`
- `null`, `false`, or `undefined` will output nothing, useful for making
    something that is toggled or catching when something isn't defined.<br />
    `[key, value] -> ""`

```js
// returns "$button r[4px] b[1px solid &main-color]"
ws.x({
    $button: true,
    r: "4px",
    hide: false,
    b: "1px solid &main-color"
})
```

#### custom, prop, rules

`custom(name, generator)`

The `custom` function allows the creation of custom wind functions to use on a
page. The name will be what is used in the ws-x property, and the generate
function will be given the processed arg string and should return a string of
css rules to apply. The `rules` and `prop` functions are available to help these
functions be easier to read and maintain.

`prop(name, value)`

The `prop` function is used with the `rules` function to help make custom wind
functions simpler. It takes a name and value and returns a css property string.
The value will replace `&<name>` with `var(--<name>)` like the other string
inputs for windstorm.

`rules(...string)`

The `rules` function will take a list of css property strings and join them
with a semicolon in between each of the rules. Internally it just treats the
argument list as an array and uses `.join`, but it looks a bit nicer than the
raw array with a join call.

```js
ws.custom(
    "debug",
    () => ws.rules(
        ws.prop("border", "2px solid red"),
        ws.prop("margin", "4px")
    )
)
```
